<ul class='guide-toc'>
	{#each $guide_contents as section}
	<li>
		<a class='section {section.slug === $activeGuideSection ? "active": ""}' href='guide#{section.slug}'>
			{section.metadata.title} {#if section.slug === $activeGuideSection}
			<Icon name='arrow-right' /> {/if}
		</a>

		{#each section.subsections as subsection}
		<!-- see <script> below: on:click='scrollTo(event, subsection.slug)' -->
		<a class='subsection {subsection.slug === $activeGuideSection ? "active": ""}' href='guide#{subsection.slug}'>
			{subsection.title} {#if subsection.slug === $activeGuideSection}
			<Icon name='arrow-right' /> {/if}
		</a>
		{/each}
	</li>
	{/each}
</ul>

<style>
	.guide-toc li {
		display: block;
		line-height: 2;
	}

	.section {
		display: block;
		font-family: var(--font-alt);
		text-transform: uppercase;
		letter-spacing: 0.1em;
		font-size: var(--h6);
		color: var(--second);
		margin-top: 4.8rem;
	}

	.subsection {
		display: block;
		font-size: var(--h6);
	}

	a:link {
		/* darken --text for accesibility */
		--text: hsl(36, 3%, 44%);
		text-decoration: none;
	}

	a:hover {
		color: var(--flash);
	}

	.active {
		color: var(--prime);
	}
</style>

<script>
	export default {
		data() {
			return {
				contents: []
			}
		},

		components: {
			Icon: './icon.html',
		},

		//	------------------------------------------
		//	TODO â€“ smooth-scroll
		//	must be something that makes more sense
		//	this one is too annoying (area too tall)
		//	maybe svelte-transitions are a solution?
		//	unfortunately I have no idea how. For now.
		//	------------------------------------------
		// methods: {
		// 	scrollTo(e, item) {
		// 		e.preventDefault();
		// 		let top = document.querySelector('#' + item).getBoundingClientRect().top;
		// 		window.scrollTo({
		// 			top,
		// 			behavior: "smooth"
		// 		});
		// 	}
		// },

		oncreate() {
			const onhashchange = _ => {
				this.store.set({ activeGuideSection: window.location.hash.slice(1) });
			};

			window.addEventListener('hashchange', onhashchange, false);
			this.on('destroy', _ => {
				window.removeEventListener('hashchange', onhashchange, false);
			});

			onhashchange();
		}
	};
</script>