<div class='component-selector'>
	<div class="panel-header">
		<ul ref:files class="file-tabs" on:dblclick='fire("create")'>
			{#each components as component}
			<li id='{component.name}' class='{ selectedComponent == component ? "active" : "" }' data-name='{component.name}'
			 on:dblclick='event.stopPropagation()'>
				<div class='file-tabs-item {component.edit ? "edit-mode" : ""}' on:click='selectComponent(component, selectedComponent)'>
					{#if component.name == 'App'}
					<div class='uneditable'>
						App.html
					</div>
					{:else}
					{#if component.edit}
					<input autofocus ref:name bind:value='component.name' on:focus='selectInput(this)' on:blur='closeEdit(selectedComponent)'
					 on:enter='this.blur()' />
					{:else}
					<div class='editable' title='edit component name' on:click='editTab(component, selectedComponent)'>
						{component.name}.{component.type}
					</div>
					{/if}
					<span class='remove' on:click='remove(component)'>
						<Icon name='close' />
						<!-- &times; -->
					</span>
					{/if}
				</div>
			</li>
			{/each}
		</ul>
	</div>

	<div class="btn-action-container">
		<a on:click='fire("create")' title="add new component">
			<Icon name='plus' />
		</a>
	</div>
</div>

<style>
	.component-selector {
		--selector-height: 4.2rem;
		position: absolute;
		top: 0;
		left: 3.2rem;
		width: 100%;
		border-bottom: 1px solid #eee;
		height: var(--selector-height);
	}

	.file-tabs-item {
		display: block;
		padding: calc(0.5em - 1px);
		background: white;
		border-radius: 0;
		position: relative;
		margin: 0;
		height: var(--selector-height);
		font: 300 1.2rem/1.5 var(--font-ui);
		color: var(--second);
	}

	input {
		width: 100%;
		padding: 1rem 1.2rem .5rem;
		font-size: 1.3rem;
		font-family: var(--font-ui);
		border: none;
		color: var(--flash);
		outline: none;
	}

	.file-tabs {
		border: none;
		padding-left: 0;
		margin: 0;
		list-style-type: none;
		white-space: nowrap;
		overflow-x: auto;
		overflow-y: hidden;

	}

	.file-tabs>li {
		display: inline-block;
		float: none;
		margin-bottom: 0;
		vertical-align: top;

	}

	.file-tabs li.active .file-tabs-item {
		border-bottom: var(--border-w) solid var(--prime);
	}

	.editable,
	.uneditable {
		display: inline-block;
		margin-right: 2.4rem;
		padding: .8rem 0.4rem;
		position: relative;
	}

	.uneditable {
		padding-left: 1.2rem;
	}

	.remove {
		position: absolute;
		display: none;
		right: .4rem;
		top: .4rem;
		width: 2.2rem;
		text-align: right;
		padding: 0.7em 0 0.5em 0.5em;
		cursor: pointer;
	}

	.remove:hover {
		color: var(--flash);
	}

	li.active .editable {
		cursor: text;
	}

	li.active .remove {
		display: inline-block;
	}

	.btn-action-container {
		position: absolute;
		left: -2rem;
		top: .8rem;
		height: var(--selector-height);

	}
</style>

<script>
	import { enter } from './events.js';

	export default {
		components: {
			Icon: '../../../components/icon.html', // is this bad practise?
		},

		methods: {
			selectComponent(component, selectedComponent) {
				const { components } = this.get();

				if (selectedComponent != component) {
					selectedComponent.edit = false;
				}
				this.set({ selectedComponent: component })
			},

			editTab(component, selectedComponent) {
				if (selectedComponent == component) {
					selectedComponent.edit = true;
					this.set({ selectedComponent });
				}
			},

			closeEdit(selectedComponent) {
				const { components } = this.get();

				const match = /(.+)\.(html|js)$/.exec(selectedComponent.name);
				selectedComponent.name = match ? match[1] : selectedComponent.name;
				if (match && match[2]) selectedComponent.type = match[2];
				selectedComponent.edit = false;
				this.set({ selectedComponent, components });
			},

			remove(component) {
				let result = confirm(`Are you sure you want to delete ${component.name}.${component.type}?`);
				if (result) this.fire('remove');
			},

			selectInput(input) {
				setTimeout(() => {
					input.select();
				});
			},

			focusLast() {

			}
		},

		events: {
			enter
		}
	};
</script>