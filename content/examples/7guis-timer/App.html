<script>
	import { onDestroy, onMount } from 'svelte';

	// [svelte-upgrade suggestion]
	// manually refactor all references to __this
	const __this = {};

	export let elapsed = 0;
	export let duration = 5000;
	export let start;

	onMount(() => {
		reset();

		const update = () => {
			__this.frame = requestAnimationFrame(update);
			const elapsed = window.performance.now() - start;

			if (elapsed > duration) return;

			elapsed = elapsed;
		};

		update();
	});

	onDestroy(() => {
		if (__this.frame) {
			cancelAnimationFrame(__this.frame);
		}
	});

	// [svelte-upgrade suggestion]
	// review these functions and remove unnecessary 'export' keywords
	export function reset() {
		start = window.performance.now();
	}
</script>

<!-- https://github.com/eugenkiss/7guis/wiki#timer -->
<label>
	elapsed time:
	<progress value='{elapsed / duration}'></progress>
</label>

<div>{ ( elapsed / 1000 ).toFixed( 1 ) }s</div>

<label>
	duration:
	<input type='range' bind:value='duration' min='1' max='20000'>
</label>

<button on:click='{reset}'>reset</button>